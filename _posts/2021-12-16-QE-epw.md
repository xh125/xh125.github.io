---
layout:     post
title:      "QUANTUM ESPRESSO：EPW"
date:       2021-12-16 22:56:00
author:     "Xiehua"
header-img: "images/post/post-bg-understand.jpg"
tags:
    - QUANTUM ESPRESSO
    - DFPT
    - EPW
---

## QUANTUM ESPRESSO：[epw.x计算electron-phonon coupling](https://epw-code.org/)

EPW is an open-source community code for ab initio calculations of electron-phonon interactions using Density-Functional Perturbation Theory and Maximally Localized Wannier Functions.

计算步骤如下：  

1. 第一步：进入phonon目录进行scf自洽计算  
   `pw.x <scf.in> scf.out`  
   **NOTE:** `outdir`需要设置为”./”,由于后面需要对ph.x计算的结果使用pp.py进行收集。

2. 使用`ph.x`进行DFPT计算，得到dvscf文件：  
   **Note:** set:  

   ```fortran
    outdir = './'
    fildyn = 'carbyne.dyn'
    fildvscf = 'dvscf'
    ```

3. 第三步：使用pp.py收集ph.x计算得到的fildvscf相关文件到save文件夹。对于使用paw赝势计算的结果，需要采用修改版的pp-paw.py.[pp-paw.py](https://github.com/xh125/LVCSH-mpi/tree/main/tools/pp-paw.py)进行处理

4. 第四步进入epw目录，先进行scf计算（或者将phonon目录中的内容拷贝过来），再进行nscf计算，需要采用homogeneous kpoint grid进行nscf计算

    `kmesh.pl 1 1 200 >>${prefix}.nscf.in`

5. 第五步设置epw.in文件，进行epw计算.注意fsthick的设置，会影响打印出来的电声耦合矩阵元包含的能带数和q点数。
    *note:* dis_win_max的值要根据fatband的结果进行设置，不能随意设置的无限高或者不设置，这样会导致得到的wannier函数很难局域化。四个能量窗口都需要根据fatband的结果仔细的设置。  

epw.in

```fortran
epw calculation of carbyne
&inputepw
  prefix = 'carbyne'
  outdir = './'
  amass(1)= 12.0107
  dvscf_dir = '../phonon/save'

  iverbosity = 0

  elph        = .true.
  epbwrite    = .true.
  epbread     = .false.
!  epwwrite    = .true.
!  epwread     = .false.
  etf_mem     = 1
  prtgkk   = .true.

!  eig_read    = .true.

  asr_typ     = 'one-dim'
  use_ws      = .true.

  wannierize = .true.
  nbndsub     =  6
!  bands_skipped = 'exclude_bands = 1-2'
  num_iter = 30000
  iprint   = 2
!  dis_win_max = 12
!  dis_win_min = -25
!  dis_froz_min = -11
  dis_froz_max = -0.55
  proj(1) = 'C:py,pz'
  proj(2) = 'C:sp-1'
  write_wfn= .true.
  wannier_plot= .true.
  wdata(1)= 'bands_plot = .false.'
  wdata(2)= 'begin kpoint_path'
  wdata(3)= 'G 0.00 0.00 0.00 M 0.50 0.00 0.00'
  wdata(4)= 'end kpoint_path'
  wdata(5)= 'bands_plot_format = gnuplot'
  wdata(6)= 'conv_tol      = 1.0e-10 '
  wdata(7)= 'conv_window   = 10      '
  wdata(8)= 'dis_conv_tol  = 1.0e-10 '
  wdata(9)= 'dis_conv_window = 5     '
  wdata(10)= 'dis_num_iter= 30000      '
  wdata(11)= 'dis_mix_ratio= 0.5      '
! wdata(12)= 'num_iter = 300        '
  wdata(13)= 'guiding_centres = .true.'
  wdata(14)= 'translate_home_cell  : true'
  wdata(15)= 'translation_centre_frac :   0.0 0.0 0.0  '

  elecselfen  = .false.
  phonselfen  = .false.
  a2f         = .false.

  fsthick     = 5.0 ! eV
  temps       = 1 ! K
  degaussw    = 0.005 ! eV

!  band_plot   = .true.
!  filkf       = './LGX.txt'
!  filqf       = './LGX.txt'

  nkf1 = 40
  nkf2 = 1
  nkf3 = 1
  nqf1 = 40
  nqf2 = 1
  nqf3 = 1

  nk1 = 20
  nk2 = 1
  nk3 = 1
  nq1 = 20
  nq2 = 1
  nq3 = 1
/ 
```
